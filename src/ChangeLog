2004-05-24  Marcus Brinkmann  <marcus@g10code.de>


	Everywhere: Pass context to invocation of _gsti_log_info and friends.
	Change _gsti_log_rc to _gsti_log_err.
	
	* gsti.h (gsti_log_level_t): New type, using the existing enum for
	GSTI_LOG_* symbols.  Add symbol GSTI_LOG_MAX.  Change the values
	of GSTI_LOG_INFO and GSTI_LOG_DEBUG to make room for insertions.
	(GSTI_LOG_FNC): Rename to ...
	(gsti_log_cb_t): ... this.  Add new argument CTX, change type of
	log level argument.
	(gsti_set_log_handler): Removed.
	(gsti_set_log_stream): New prototype.
	(gsti_set_log_level): Add new argument CTX.
	* utils.h (_gsti_log_rc, _gsti_log_info, _gsti_log_debug): Add
	argument CTX to prototype.
	(_gsti_get_log_level): Prototype removed.
	* api.h (struct gsti_context): New members LOG_CB, LOG_CB_HOOK,
	and LOG_LEVEL.
	* main.c (log_handler, log_handler_value, log_level,
	_gsti_get_log_level): Removed.
	(_gsti_logv, _gsti_log_rc, _gsti_log_info, _gsti_log_debug,
	gsti_set_log_level): Moved to ...
	* logging.c: ... this new file.
	* Makefile.am (libgsti_la_SOURCES): Add logging.c.

2004-03-08  Werner Koch  <wk@gnupg.org>

        Changed indentation to GNU style.
	
2004-03-08  Werner Koch  <wk@gnupg.org>

	* main.c (map_gcry_rc): Shortcut code as we are now using
	gpg-error.h anyway.

	* Makefile.am: Modernized.  Use --version-info.
	(libgsti_la_SOURCES): Added pubkey.h.

	* gsti-config.in: Modernized.

        Fixed all copyright entries from "Free Software Foundation, Inc"
	to "Werner Koch".  It was originally intended to assign the code
	to the FSF but this actually never happened and frankly there has
	been no real release as the code lived his life for most time
	merely as a test bed for libgcrypt.
	
	* ChangeLog: Merged my entries from 2000.  Obviously I forgot to
	commit the Changelog to the CVS when moving the files from the
	local PRCS repository to CVS.

2002-10-05  Timo Schulz  (ts@winpt.org)

	* kex.c (kex_send_init_packet): Fixed memory leak.
	* main.c (gsti_deinit): Free auth struct.
	(gsti_set_client_key): New.
	(gsti_set_client_user): New.
	(gsti_set_auth_method): New.
	(_gsti_free_auth): New.
	* api.h: Added auth struct to the GSTI struct.
	* auth.c (auth_send_init_packet): New.
	(auth_proc_init_packet): New.
	(auth_send_accept_packet): New.
	(auth_proc_accept_packet): New.
	(auth_send_second_packet): New.
	(auth_proc_second_packet): New.
	* utils.c (_gsti_bstring_hash): Moved from kex.c and
	renamed from hash_bstring. Now it's global.
	
2002-10-06  Timo Schulz  (ts@winpt.org)

	* fsm.c (fsm_server_loop): New.
	(fsm_client_loop): New.
	(new_state): Removed. The code is now in the functions above.
	(fsm_loop): Now we use separate loops.
	* auth.c (auth_send_accept_packet): Flush the packet.
	(auth_send_init_packet): Ditto.
	(auth_send_second_packet): Ditto.

2002-10-06  Timo Schulz  (ts@winpt.org)
	* auth.c (auth_send_pkok_packet): New.
	(auth_proc_pkok_packet): New.
	* fsm.c (fsm_server_loop): Send the SSH_MSG_USERAUTH_PK_OK and
	not the SSH_MSG_USERAUTH_SUCCESS twice.
	(fsm_client_loop): Proc the new packets.
	(pubkey.h): Prefix key context with gsti_.
	
2002-10-07  Timo Schulz  (ts@winpt.org)

	* pubkey.c (read_dss_key): Store 'x' in secure memory.
	* auth.c (parse_pkok_packet): New.
	(auth_proc_pkok_packet): Use it here.
	Check the data returned by the server.
	* pubkey.c (_gsti_ssh_cmp_keys): New.
	(_gsti_ssh_cmp_pkname): New.
	* zlib.c: New. Taken from PuTTY. It's a MIT style license
	and so it's compatible with the GPL. 
	But we don't use compression by default.
	* utils.h: Provide zlib prototypes or dummies.
	* main.c (gsti_set_compression): New.
	* kex.c (build_compress_list): New.
	(kex_send_init_packet): Use it here.
	
2002-10-08  Timo Schulz  (ts@winpt.org)

	* utils.c (_gsti_dump_object): Use the logging stuff and
	not fprintf. Support to dump BUFFER's.
	(_gsti_print_string): Removed the FILE* argument.
	Changed all callers.
	* buffer.c (_gsti_buf_putbstr): New.
	* auth.c: Changed all _gsti_buf_putstr to _gsti_buf_putbstr.
	* kex.c: Likewise.
	* api.h: Created zlib struct inside GSTI handle.
	* memory.c (_gsti_xmalloc): Implemented common xfoo memory
	wrapper so they fail when there is a memory problem.
	(_gsti_xrealloc): Ditto.
	(_gsti_xcalloc): Ditto.
	(_gsti_xstrdup): Ditto.
	
2002-10-19  Timo Schulz  (ts@winpt.org)

	* pubkey.c (pktype_from_file): New.
	(gsti_key_load): Use it here and remove the pktype param.
	* packet.c (print_debug_msg): Free buffer.
	* moduli.h: New. Contains various modulus values for the
	DH group exchange method.
	
	
2002-10-19  Timo Schulz  (ts@winpt.org)

	* packet.h: Added DH group numbers.
	* kex.c (build_gex_request): New.
	(kex_send_gex_request): New.
	(parse_gex_request): New.
	(kex_proc_gex_request): New.
	(select_dh_modulus): New.
	(choose_dh_size): New.
	(kex_send_gex_group): New.
	
2002-10-20  Timo Schulz  (ts@winpt.org)

	* api.h: Use a BUFFER to read from the payload.
	* kex.c (parse_xxx): Use a BUFFER as the input.
	Changed all callers.
	(build_kex_list): New.
	(build_pkalgo_list): New.
	(choose_kex_algo): New.
	* auth.c (parse_xxx): Some as kex.c
	* main.c (init_gex_default): New.
	(gsti_init): Use it here.
	
2000-10-10  Werner Koch  <wk@gnupg.org>

	* api.h (gsti_context): Replaced *mac_{inner,outer}_hd by *mac_hd.
	* kex.c (prepare_mac): Changed to use the libgcrypt function,
	changed args and adjusted all callers.
	(prepare_hmac_pad): Removed.
	* packet.c (generate_mac, verify_mac): Use libgcrypt function.
	
	