2002-10-05  Timo Schulz  (ts@winpt.org)

	* kex.c (kex_send_init_packet): Fixed memory leak.
	* main.c (gsti_deinit): Free auth struct.
	(gsti_set_client_key): New.
	(gsti_set_client_user): New.
	(gsti_set_auth_method): New.
	(_gsti_free_auth): New.
	* api.h: Added auth struct to the GSTI struct.
	* auth.c (auth_send_init_packet): New.
	(auth_proc_init_packet): New.
	(auth_send_accept_packet): New.
	(auth_proc_accept_packet): New.
	(auth_send_second_packet): New.
	(auth_proc_second_packet): New.
	* utils.c (_gsti_bstring_hash): Moved from kex.c and
	renamed from hash_bstring. Now it's global.
	
2002-10-06  Timo Schulz  (ts@winpt.org)

	* fsm.c (fsm_server_loop): New.
	(fsm_client_loop): New.
	(new_state): Removed. The code is now in the functions above.
	(fsm_loop): Now we use separate loops.
	* auth.c (auth_send_accept_packet): Flush the packet.
	(auth_send_init_packet): Ditto.
	(auth_send_second_packet): Ditto.

2002-10-06  Timo Schulz  (ts@winpt.org)
	* auth.c (auth_send_pkok_packet): New.
	(auth_proc_pkok_packet): New.
	* fsm.c (fsm_server_loop): Send the SSH_MSG_USERAUTH_PK_OK and
	not the SSH_MSG_USERAUTH_SUCCESS twice.
	(fsm_client_loop): Proc the new packets.
	
	
	
	
	
	
